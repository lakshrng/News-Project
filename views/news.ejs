<%- include("partials/header", { marqueeItems: (articles || []).map((a, i) => ({ title: a.title, url: '/news#a-' + i })) }) %>
<section class="section">
  <h2 class="page-title">Latest News</h2>
  <p class="subtitle"><small>Political News Â· India & World (last 24 hours)</small></p>
  <form id="newsSearchForm" onsubmit="return false" style="margin-top:12px; display:flex; gap:8px; align-items:center;">
    <input type="text" id="newsSearchInput" placeholder="Search headlines or snippets..." aria-label="Search news" style="flex:1; padding:10px 12px; border:1px solid var(--border); border-radius:10px;" />
    <button type="button" class="btn" id="newsSearchBtn">Search</button>
  </form>
  <% if (articles.length === 0) { %>
    <p class="muted">No news found.</p>
  <% } else { %>
    <div class="news-container">
      <% articles.forEach((article, idx) => { %>
        <div class="news-card" id="a-<%= idx %>" data-title="<%- (article.title || '').toLowerCase() %>" data-snippet="<%- (article.snippet || '').toLowerCase() %>">
          <% if (article.image_url) { %>
            <img src="<%= article.image_url %>" alt="News image" onerror="this.style.display='none'">
          <% } %>
          <h3>
            <a href="<%= article.url %>" target="_blank"><%= article.title %></a>
          </h3>
          <p><%= article.snippet %></p>
          <small>
            Published: <%= article.published_at %>
            <% if (article.category) { %> | Category: <%= article.category %> <% } %>
          </small>

          <!-- Analysis button -->
          <a class="btn" href="/analysis?title=<%- encodeURIComponent(article.title) %>&snippet=<%- encodeURIComponent(article.snippet || '') %>&image_url=<%- encodeURIComponent(article.image_url || '') %>">Read Analysis</a>
        </div>
      <% }) %>
    </div>
  <% } %>
</section>
<script>
  (function(){
    const input = document.getElementById('newsSearchInput');
    const btn = document.getElementById('newsSearchBtn');
    if (!input || !btn) return;
    function searchAndScroll(){
      const q = (input.value || '').toLowerCase().trim();
      if (!q) return;
      const cards = Array.from(document.querySelectorAll('.news-card'));
      const match = cards.find(c => (c.dataset.title||'').includes(q) || (c.dataset.snippet||'').includes(q));
      if (match) {
        const id = match.getAttribute('id');
        if (id) { location.hash = '#' + id; }
        match.classList.remove('highlight-pulse');
        void match.offsetWidth; // reflow to restart animation
        match.classList.add('highlight-pulse');
        input.blur();
      }
    }
    btn.addEventListener('click', searchAndScroll);
    input.addEventListener('keydown', function(e){ if(e.key === 'Enter'){ e.preventDefault(); searchAndScroll(); } });
  })();
</script>
<%- include("partials/footer") %>
